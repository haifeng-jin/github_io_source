---
layout: post
title: poj1521
category: chinese
---
<p>霍夫曼编码，建树</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('bed09db7-6925-42c6-8018-9c71333416c1')"><img id="code_img_closed_bed09db7-6925-42c6-8018-9c71333416c1" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_bed09db7-6925-42c6-8018-9c71333416c1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bed09db7-6925-42c6-8018-9c71333416c1',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" />
<div id="cnblogs_code_open_bed09db7-6925-42c6-8018-9c71333416c1" class="cnblogs_code_hide">
<pre>#include &lt;cstdio&gt;<span style="color: #000000;">
#include </span>&lt;cstring&gt;<span style="color: #000000;">
#include </span>&lt;queue&gt;
<span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;

</span><span style="color: #0000ff;">#define</span> MAX_LENGTH 1005
<span style="color: #0000ff;">#define</span> MAX_ASCII 205
<span style="color: #0000ff;">#define</span> MAX_CHAR_CNT 300

<span style="color: #0000ff;">struct</span><span style="color: #000000;"> Elem
{
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> pos;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> cnt;
    Elem()
    {}
    Elem(</span><span style="color: #0000ff;">int</span> pp, <span style="color: #0000ff;">int</span><span style="color: #000000;"> cc): pos(pp), cnt(cc)
    {}
};

</span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Node
{
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> left_child;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> right_child;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> count;
}node[MAX_CHAR_CNT];

</span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> vis[MAX_CHAR_CNT];
</span><span style="color: #0000ff;">char</span><span style="color: #000000;"> text[MAX_LENGTH];
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> occurence_count[MAX_ASCII];
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> node_cnt;
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> original_length;
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> ans;
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> char_cnt;

</span><span style="color: #0000ff;">bool</span> <span style="color: #0000ff;">operator</span> &lt; (<span style="color: #0000ff;">const</span> Elem &amp;a, <span style="color: #0000ff;">const</span> Elem &amp;<span style="color: #000000;">b)
{
    </span><span style="color: #0000ff;">return</span> a.cnt &gt;<span style="color: #000000;"> b.cnt;
}

</span><span style="color: #0000ff;">void</span> add_char(<span style="color: #0000ff;">char</span><span style="color: #000000;"> ch)
{
    </span><span style="color: #0000ff;">int</span> asc = (<span style="color: #0000ff;">int</span><span style="color: #000000;">)ch;
    occurence_count[asc]</span>++<span style="color: #000000;">;
}

</span><span style="color: #0000ff;">void</span> add_node(<span style="color: #0000ff;">int</span><span style="color: #000000;"> cnt)
{
    node[node_cnt].count </span>=<span style="color: #000000;"> cnt;
    node[node_cnt].left_child </span>= -<span style="color: #800080;">1</span><span style="color: #000000;">;
    node[node_cnt].right_child </span>= -<span style="color: #800080;">1</span><span style="color: #000000;">;
    node_cnt</span>++<span style="color: #000000;">;
}

</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> count_char()
{
    memset(occurence_count, </span><span style="color: #800080;">0</span>, <span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(occurence_count));
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; text[i]; i++<span style="color: #000000;">)
    {
        add_char(text[i]);
    }
    node_cnt </span>= <span style="color: #800080;">0</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = (<span style="color: #0000ff;">int</span>)<span style="color: #800000;">'</span><span style="color: #800000;">A</span><span style="color: #800000;">'</span>; i &lt;= (<span style="color: #0000ff;">int</span>)<span style="color: #800000;">'</span><span style="color: #800000;">Z</span><span style="color: #800000;">'</span>; i++<span style="color: #000000;">)
    {
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (occurence_count[i])
        {
            add_node(occurence_count[i]);
        }
    }
    </span><span style="color: #0000ff;">if</span> (occurence_count[(<span style="color: #0000ff;">int</span>)<span style="color: #800000;">'</span><span style="color: #800000;">_</span><span style="color: #800000;">'</span><span style="color: #000000;">])
        add_node(occurence_count[(</span><span style="color: #0000ff;">int</span>)<span style="color: #800000;">'</span><span style="color: #800000;">_</span><span style="color: #800000;">'</span><span style="color: #000000;">]);
    original_length </span>= strlen(text) * <span style="color: #800080;">8</span><span style="color: #000000;">;
    char_cnt </span>=<span style="color: #000000;"> node_cnt;
}

</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> build_tree()
{
    priority_queue</span>&lt;Elem&gt;<span style="color: #000000;"> pq;
    memset(vis, </span><span style="color: #800080;">0</span>, <span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(vis));
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; node_cnt; i++<span style="color: #000000;">)
        pq.push(Elem(i, node[i].count));
    </span><span style="color: #0000ff;">while</span> (pq.size() &gt; <span style="color: #800080;">1</span><span style="color: #000000;">)
    {
        Elem a </span>=<span style="color: #000000;"> pq.top();
        pq.pop();
        Elem b </span>=<span style="color: #000000;"> pq.top();
        pq.pop();
        node[node_cnt].left_child </span>=<span style="color: #000000;"> a.pos;
        node[node_cnt].right_child </span>=<span style="color: #000000;"> b.pos;
        node[node_cnt].count </span>= a.cnt +<span style="color: #000000;"> b.cnt;
        pq.push(Elem(node_cnt, a.cnt </span>+<span style="color: #000000;"> b.cnt));
        node_cnt</span>++<span style="color: #000000;">;
        vis[a.pos] </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
        vis[b.pos] </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
    }
}

</span><span style="color: #0000ff;">void</span> dfs(<span style="color: #0000ff;">int</span> id, <span style="color: #0000ff;">int</span><span style="color: #000000;"> depth)
{
    </span><span style="color: #0000ff;">if</span> (node[id].left_child == -<span style="color: #800080;">1</span> &amp;&amp; node[id].right_child == -<span style="color: #800080;">1</span><span style="color: #000000;">)
    {
        ans </span>+= node[id].count *<span style="color: #000000;"> depth;
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
    }
    </span><span style="color: #0000ff;">if</span> (node[id].left_child != -<span style="color: #800080;">1</span><span style="color: #000000;">)
        dfs(node[id].left_child, depth </span>+ <span style="color: #800080;">1</span><span style="color: #000000;">);
    </span><span style="color: #0000ff;">if</span> (node[id].right_child != -<span style="color: #800080;">1</span><span style="color: #000000;">)
        dfs(node[id].right_child, depth </span>+ <span style="color: #800080;">1</span><span style="color: #000000;">);
}

</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
{
    </span><span style="color: #0000ff;">while</span> (scanf(<span style="color: #800000;">"</span><span style="color: #800000;">%s</span><span style="color: #800000;">"</span>, text), strcmp(text, <span style="color: #800000;">"</span><span style="color: #800000;">END</span><span style="color: #800000;">"</span><span style="color: #000000;">))
    {
        count_char();
        </span><span style="color: #0000ff;">if</span> (char_cnt == <span style="color: #800080;">1</span><span style="color: #000000;">)
        {
            printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d %d 8.0\n</span><span style="color: #800000;">"</span>, original_length, original_length / <span style="color: #800080;">8</span><span style="color: #000000;">);
            </span><span style="color: #0000ff;">continue</span><span style="color: #000000;">;
        }
        build_tree();
        ans </span>= <span style="color: #800080;">0</span><span style="color: #000000;">;
        dfs(node_cnt </span>- <span style="color: #800080;">1</span>, <span style="color: #800080;">0</span><span style="color: #000000;">);
        printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d %d %.1f\n</span><span style="color: #800000;">"</span>, original_length, ans, original_length * <span style="color: #800080;">1.0</span> /<span style="color: #000000;"> ans);
    }
    </span><span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
}</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code </span></div>
<p>&nbsp;</p>
