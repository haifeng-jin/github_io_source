---
layout: post
title: poj1127
category: chinese
---
<p>floyd+几何计算</p>
<p>线段相交</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('05595c38-e7e7-4eb8-b661-cf7fca832c2c')"><img id="code_img_closed_05595c38-e7e7-4eb8-b661-cf7fca832c2c" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" /><img style="display: none;" id="code_img_opened_05595c38-e7e7-4eb8-b661-cf7fca832c2c" class="code_img_opened" onclick="cnblogs_code_hide('05595c38-e7e7-4eb8-b661-cf7fca832c2c',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" /><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_05595c38-e7e7-4eb8-b661-cf7fca832c2c" class="cnblogs_code_hide">
<pre><span style="color: #000000;">#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">iostream</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstdlib</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstring</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstdio</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> </span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;<br /><br /></span><span style="color: #0000ff;">#define</span><span style="color: #000000;"> maxn 20</span><span style="color: #000000;"><br /></span><span style="color: #0000ff;">#define</span><span style="color: #000000;"> zero(x) (((x)&gt;0?(x):-(x))&lt;eps)</span><span style="color: #000000;"><br /></span><span style="color: #0000ff;">#define</span><span style="color: #000000;"> eps 1.0E-8</span><span style="color: #000000;"><br /><br /></span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Point<br />{<br />    </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> x, y;<br />};<br /><br /></span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Line<br />{<br />    Point a, b;<br />} straw[maxn];<br /><br /></span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> g[maxn][maxn];<br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> n;<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> input()<br />{<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> n; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />        scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%lf%lf%lf%lf</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">straw[i].a.x, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">straw[i].a.y, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">straw[i].b.x, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">straw[i].b.y);<br />}<br /><br /></span><span style="color: #0000ff;">double</span><span style="color: #000000;"> xmult(Point p1, Point p2, Point p0)<br />{<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (p1.x </span><span style="color: #000000;">-</span><span style="color: #000000;"> p0.x) </span><span style="color: #000000;">*</span><span style="color: #000000;"> (p2.y </span><span style="color: #000000;">-</span><span style="color: #000000;"> p0.y) </span><span style="color: #000000;">-</span><span style="color: #000000;"> (p2.x </span><span style="color: #000000;">-</span><span style="color: #000000;"> p0.x) </span><span style="color: #000000;">*</span><span style="color: #000000;"> (p1.y </span><span style="color: #000000;">-</span><span style="color: #000000;"> p0.y);<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> dots_inline(Point p1, Point p2, Point p3)<br />{<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> zero(xmult(p1, p2, p3));<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> same_side(Point p1, Point p2, Line l)<br />{<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> xmult(l.a, p1, l.b) </span><span style="color: #000000;">*</span><span style="color: #000000;"> xmult(l.a, p2, l.b) </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> eps;<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> dot_online_in(Point p, Line l)<br />{<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> zero(xmult(p, l.a, l.b)) </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> (l.a.x </span><span style="color: #000000;">-</span><span style="color: #000000;"> p.x) </span><span style="color: #000000;">*</span><span style="color: #000000;"> (l.b.x </span><span style="color: #000000;">-</span><span style="color: #000000;"> p.x) </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> eps </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> (l.a.y </span><span style="color: #000000;">-</span><span style="color: #000000;"> p.y) </span><span style="color: #000000;">*</span><span style="color: #000000;"> (l.b.y </span><span style="color: #000000;">-</span><span style="color: #000000;"> p.y) </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> eps;<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> intersect_in(Line u, Line v)<br />{<br />    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">dots_inline(u.a, u.b, v.a) </span><span style="color: #000000;">||</span><span style="color: #000000;"> </span><span style="color: #000000;">!</span><span style="color: #000000;">dots_inline(u.a, u.b, v.b))<br />        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #000000;">!</span><span style="color: #000000;">same_side(u.a, u.b, v) </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> </span><span style="color: #000000;">!</span><span style="color: #000000;">same_side(v.a, v.b, u);<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> dot_online_in(u.a, v) </span><span style="color: #000000;">||</span><span style="color: #000000;"> dot_online_in(u.b, v) </span><span style="color: #000000;">||</span><span style="color: #000000;"> dot_online_in(v.a, u) </span><span style="color: #000000;">||</span><span style="color: #000000;"> dot_online_in(v.b, u);<br />}<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> make()<br />{<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> n; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />        g[i][i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> n </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> j </span><span style="color: #000000;">=</span><span style="color: #000000;"> i </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">; j </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> n; j</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (intersect_in(straw[i], straw[j]))<br />                g[i][j] </span><span style="color: #000000;">=</span><span style="color: #000000;"> g[j][i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br />}<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> floyd()<br />{<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> k </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; k </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> n; k</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> n; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> j </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; j </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> n; j</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (g[i][k] </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> g[k][j])<br />                    g[i][j] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> main()<br />{<br />    </span><span style="color: #008000;">//</span><span style="color: #008000;">freopen("t.txt", "r", stdin);</span><span style="color: #008000;"><br /></span><span style="color: #000000;">    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">n), n)<br />    {<br />        memset(g, </span><span style="color: #800080;">0</span><span style="color: #000000;">, </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(g));<br />        input();<br />        make();<br />        floyd();<br />        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> a, b;<br />        </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d%d</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">a, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">b), a </span><span style="color: #000000;">|</span><span style="color: #000000;"> b)<br />        {<br />            a</span><span style="color: #000000;">--</span><span style="color: #000000;">;<br />            b</span><span style="color: #000000;">--</span><span style="color: #000000;">;<br />            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (g[a][b])<br />                printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">CONNECTED\n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br />            </span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br />                printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">NOT CONNECTED\n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br />        }<br />    }<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />}</span></pre>
</div>
</div>
<p></p>
