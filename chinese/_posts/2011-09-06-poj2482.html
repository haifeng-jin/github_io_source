---
layout: post
title: poj2482
category: chinese
---
<p>题意：平面上有许多点，每个点有一个权值。给定一个大小确定的矩形，边与x，y轴平行，平移这个矩形能圈住的点的权值之和最大是多少。</p>
<p>分析：线段树 c++ac g++re</p>
<p>先把题目转化一下，用矩形的中心点来描述这个矩形的位置。并对每个点建立一个矩形中心点的活动范围，即矩形中心点在这个范围内即可覆盖到该点，建立方法就是以每个点为中心画一个与题中矩形大小相等的矩形。现在点变成了矩形，矩形变成了点。我们要求的是找一个位置来放这个点使得它在最多的矩形内部，即该点的矩形重叠层数最多。</p>
<p>这样我们就可以用线段树来解决了，用一条与y轴平行的扫描线，从左到右来扫描这个矩形重叠图。这条扫描线就是线段树中的整条线段区间，在一个时刻这个线段的不同位置被覆盖了不同层数的矩形，对每次扫描线产生变化后（扫入某一矩形或扫出某一矩形后）求现在正在扫的矩形在线段上覆盖的最大层数。</p>
<p>具体做法是按从左到右的顺序，看所有矩形的左边缘和右边缘，遇到左边缘则将该线段加入线段树，遇到右边缘则将该线段从线段树中删除，每次加入或删除后都要求依次最大覆盖层数，来更新答案。</p>
<p>现在遇到的线段树共有如下几种：</p>
<p>1.插入点型</p>
<p>对于这种线段树，通常是向线段树中插入点，即对应一个叶子节点的信息，而线段树中所有节点也都是记录的关于以该点为根的子树中已插入的点的统计信息，询问通常是问线段树中某个区间对叶子节点的统计信息。</p>
<p>2.线覆盖型</p>
<p>对于这种线段树，与第三种有一下共同特点：所有询问和插入操作都是以区间为单位的，每次都是对一个区间进行操作。每个节点通常会用一个变量来记录以它为跟的子树的相关信息，在回溯过程中更新此变量。当操作的区间能完整的覆盖一个节点对应的区间时直接对该节点操作，不再向下操作。</p>
<p>这种线段树还有其独有的特点：当操作一个短线段时，这个短线段在线段树中由上至下运行到自己对应的位置，这个过程中会经过若干个对应长线段的节点，在经过长线段时，要把长线段的节点中的信息移动到其两个直接子节点中，然后再继续向下走。这样可以保证区间信息存储位置的在树中的纵向专一性，即树中节点的直系血亲之间只能有一个点记录信息。</p>
<p>原因如下：在这种线段树的题通常具有以下性质：(1)新插入线段与旧的线段重叠的部分的信息如果纵向分布，不存储在同一个节点中，则在回溯统计子树信息过程很难计算。(2)新插入的线段与旧线段的重叠部分可以只保存新线段信息，这样才能插入过程中完整覆盖一个节点时不用向下操作。</p>
<p>3.线保留型</p>
<p>这种线段树除了与第二种线段树的共同特点外，还有一个重要特性就是即使旧线段与新线段重叠了旧线段中的信息也仍然有意义，或者要求插入的线段必须保持在其插入的位置不向下迭代。</p>
<p>其中保持位置的一种典型情况就是有删除操作。删除并不是随意的删除，每次删除的线段与原来插入的线段相对应，只删除那些曾经插入过的线段。这种通常我们为了删除时候方便，在短线段向下运行经过长线段的过程中不会把长线段向下迭代，因为长线段是要被删除的，如果向下迭代删除时就没有办法对长线段原来的存储节点进行操作，只能对其许许多多的后代节点中的一些（那些被迭代到了的节点）进行操作，复杂度极高。这种线段树的题通常信息纵向分布也是可以回溯计算的。</p>
<p>&nbsp;</p>
<p>有时候可能还要综合运用第2、3种线段树。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('78994c71-7ee8-4400-ae17-0b5bc4faeb5a')"><img id="code_img_closed_78994c71-7ee8-4400-ae17-0b5bc4faeb5a" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_78994c71-7ee8-4400-ae17-0b5bc4faeb5a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('78994c71-7ee8-4400-ae17-0b5bc4faeb5a',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" /><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_78994c71-7ee8-4400-ae17-0b5bc4faeb5a" class="cnblogs_code_hide">
<pre><span style="color: #000000;">#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">iostream</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstdlib</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstring</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstdio</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">algorithm</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #0000ff;">using</span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;<br /><br /></span><span style="color: #0000ff;">#define</span><span style="color: #000000;"> maxn 100005</span><span style="color: #000000;"><br /><br /></span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Node<br />{<br />    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> l, r, value, c;<br />    Node </span><span style="color: #000000;">*</span><span style="color: #000000;">pleft, </span><span style="color: #000000;">*</span><span style="color: #000000;">pright;<br />} tree[maxn </span><span style="color: #000000;">*</span><span style="color: #800080;">6</span><span style="color: #000000;">];<br /><br /></span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Line<br />{<br />    </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> l, r, x;<br />    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> value;<br />    </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> end;<br />} line[maxn </span><span style="color: #000000;">*</span><span style="color: #800080;">2</span><span style="color: #000000;">];<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> n, ax, ay;<br /></span><span style="color: #0000ff;">double</span><span style="color: #000000;"> dy[maxn </span><span style="color: #000000;">*</span><span style="color: #800080;">2</span><span style="color: #000000;">];<br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> lcount, ncount, tot;<br /><br /></span><span style="color: #0000ff;">bool</span><span style="color: #0000ff;">operator</span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">const</span><span style="color: #000000;"> Line </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">a, </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> Line </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">b)<br />{<br />    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (a.x </span><span style="color: #000000;">!=</span><span style="color: #000000;"> b.x)<br />        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> a.x </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> b.x;<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> a.end;<br />}<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> input()<br />{<br />    lcount </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />    tot </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> n; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />    {<br />        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> x, y, c;<br />        </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> xx </span><span style="color: #000000;">=</span><span style="color: #000000;"> ax </span><span style="color: #000000;">/</span><span style="color: #800080;">2.0</span><span style="color: #000000;">-</span><span style="color: #800080;">0.1</span><span style="color: #000000;">;<br />        </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> yy </span><span style="color: #000000;">=</span><span style="color: #000000;"> ay </span><span style="color: #000000;">/</span><span style="color: #800080;">2.0</span><span style="color: #000000;">-</span><span style="color: #800080;">0.1</span><span style="color: #000000;">;<br />        scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d%d%d</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">x, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">y, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">c);<br />        line[lcount].l </span><span style="color: #000000;">=</span><span style="color: #000000;"> y </span><span style="color: #000000;">-</span><span style="color: #000000;"> yy;<br />        line[lcount].r </span><span style="color: #000000;">=</span><span style="color: #000000;"> y </span><span style="color: #000000;">+</span><span style="color: #000000;"> yy;<br />        line[lcount].x </span><span style="color: #000000;">=</span><span style="color: #000000;"> x </span><span style="color: #000000;">-</span><span style="color: #000000;"> xx;<br />        line[lcount].value </span><span style="color: #000000;">=</span><span style="color: #000000;"> c;<br />        line[lcount].end </span><span style="color: #000000;">=</span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br />        dy[tot</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> line[lcount].l;<br />        dy[tot</span><span style="color: #000000;">++</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> line[lcount].r;<br />        lcount</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br /><br />        line[lcount].l </span><span style="color: #000000;">=</span><span style="color: #000000;"> y </span><span style="color: #000000;">-</span><span style="color: #000000;"> yy;<br />        line[lcount].r </span><span style="color: #000000;">=</span><span style="color: #000000;"> y </span><span style="color: #000000;">+</span><span style="color: #000000;"> yy;<br />        line[lcount].x </span><span style="color: #000000;">=</span><span style="color: #000000;"> x </span><span style="color: #000000;">+</span><span style="color: #000000;"> xx;<br />        line[lcount].value </span><span style="color: #000000;">=</span><span style="color: #000000;"> c;<br />        line[lcount].end </span><span style="color: #000000;">=</span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br />        lcount</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br />    }<br />}<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> buildtree(Node </span><span style="color: #000000;">*</span><span style="color: #000000;">proot, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> l, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> r)<br />{<br />    proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">l </span><span style="color: #000000;">=</span><span style="color: #000000;"> l;<br />    proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">r </span><span style="color: #000000;">=</span><span style="color: #000000;"> r;<br />    proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">value </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />    proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">c </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (l </span><span style="color: #000000;">==</span><span style="color: #000000;"> r)<br />        </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> mid </span><span style="color: #000000;">=</span><span style="color: #000000;"> (l </span><span style="color: #000000;">+</span><span style="color: #000000;"> r) </span><span style="color: #000000;">/</span><span style="color: #800080;">2</span><span style="color: #000000;">;<br />    ncount</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br />    proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">pleft </span><span style="color: #000000;">=</span><span style="color: #000000;"> tree </span><span style="color: #000000;">+</span><span style="color: #000000;"> ncount;<br />    ncount</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br />    proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">pright </span><span style="color: #000000;">=</span><span style="color: #000000;"> tree </span><span style="color: #000000;">+</span><span style="color: #000000;"> ncount;<br />    buildtree(proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">pleft, l, mid);<br />    buildtree(proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">pright, mid </span><span style="color: #000000;">+</span><span style="color: #800080;">1</span><span style="color: #000000;">, r);<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> binarysearch(</span><span style="color: #0000ff;">double</span><span style="color: #000000;"> a)<br />{<br />    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> l </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> r </span><span style="color: #000000;">=</span><span style="color: #000000;"> tot </span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (l </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> r)<br />    {<br />        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> mid </span><span style="color: #000000;">=</span><span style="color: #000000;"> (l </span><span style="color: #000000;">+</span><span style="color: #000000;"> r) </span><span style="color: #000000;">/</span><span style="color: #800080;">2</span><span style="color: #000000;">;<br />        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (dy[mid] </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> a)<br />            l </span><span style="color: #000000;">=</span><span style="color: #000000;"> mid </span><span style="color: #000000;">+</span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />        </span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br />            r </span><span style="color: #000000;">=</span><span style="color: #000000;"> mid;<br />    }<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> l;<br />}<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> add(Node </span><span style="color: #000000;">*</span><span style="color: #000000;">proot, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> l, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> r, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> c)<br />{<br />    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (l </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">r </span><span style="color: #000000;">||</span><span style="color: #000000;"> r </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">l)<br />        </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (l </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">l </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> r </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">r)<br />    {<br />        proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">c </span><span style="color: #000000;">+=</span><span style="color: #000000;"> c;<br />        proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">value </span><span style="color: #000000;">+=</span><span style="color: #000000;"> c;<br />        </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;<br />    }<br />    add(proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">pleft, l, r, c);<br />    add(proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">pright, l, r, c);<br />    proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">value </span><span style="color: #000000;">=</span><span style="color: #000000;"> max(proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">pleft</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">value, proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">pright</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">value) </span><span style="color: #000000;">+</span><span style="color: #000000;"> proot</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">c;<br />}<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> work()<br />{<br />    ncount </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />    buildtree(tree, </span><span style="color: #800080;">0</span><span style="color: #000000;">, tot </span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">);<br />    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> ans </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> lcount; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />    {<br />        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> l </span><span style="color: #000000;">=</span><span style="color: #000000;"> binarysearch(line[i].l);<br />        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> r </span><span style="color: #000000;">=</span><span style="color: #000000;"> binarysearch(line[i].r);<br />        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">line[i].end)<br />        {<br />            add(tree, l, r, line[i].value);<br />            ans </span><span style="color: #000000;">=</span><span style="color: #000000;"> max(ans, tree[</span><span style="color: #800080;">0</span><span style="color: #000000;">].value);<br />        }<br />        </span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br />            add(tree, l, r, </span><span style="color: #000000;">-</span><span style="color: #000000;">line[i].value);<br />    }<br />    printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span><span style="color: #000000;">, ans);<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> main()<br />{<br />    </span><span style="color: #008000;">//</span><span style="color: #008000;">freopen("t.txt", "r", stdin);</span><span style="color: #008000;"><br /></span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d%d%d</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">n, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">ax, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">ay) </span><span style="color: #000000;">!=</span><span style="color: #000000;"> EOF)<br />    {<br />        memset(tree, </span><span style="color: #800080;">0</span><span style="color: #000000;">, </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(tree));<br />        input();<br />        sort(line, line </span><span style="color: #000000;">+</span><span style="color: #000000;"> lcount);<br />        sort(dy, dy </span><span style="color: #000000;">+</span><span style="color: #000000;"> tot);<br />        tot </span><span style="color: #000000;">=</span><span style="color: #000000;"> unique(dy, dy </span><span style="color: #000000;">+</span><span style="color: #000000;"> tot) </span><span style="color: #000000;">-</span><span style="color: #000000;"> dy;<br />        work();<br />    }<br />    </span><span style="color: #0000ff;">return</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />}</span></pre>
</div>
</div>
