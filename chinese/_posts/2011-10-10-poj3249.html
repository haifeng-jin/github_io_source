---
layout: post
title: poj3249
category: chinese
---
<p>记忆化搜索</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('355fdf93-6b60-4bd4-84cf-b13563d9ffaa')"><img id="code_img_closed_355fdf93-6b60-4bd4-84cf-b13563d9ffaa" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" /><img style="display: none;" id="code_img_opened_355fdf93-6b60-4bd4-84cf-b13563d9ffaa" class="code_img_opened" onclick="cnblogs_code_hide('355fdf93-6b60-4bd4-84cf-b13563d9ffaa',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" /><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_355fdf93-6b60-4bd4-84cf-b13563d9ffaa" class="cnblogs_code_hide">
<pre>#include &lt;iostream&gt;<br />#include &lt;cstdlib&gt;<br />#include &lt;cstring&gt;<br />#include &lt;cstdio&gt;<br /><span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span> std;<br /><br /><span style="color: #0000ff;">#define</span> maxn 100005<br /><span style="color: #0000ff;">#define</span> maxm 1000005<br /><br /><span style="color: #0000ff;">struct</span> Edge<br />{<br />    <span style="color: #0000ff;">int</span> v, next;<br />}edge[maxm];<br /><br /><span style="color: #0000ff;">int</span> n, m;<br /><span style="color: #0000ff;">int</span> value[maxn];<br /><span style="color: #0000ff;">int</span> <span style="color: #0000ff;">in</span>[maxn], <span style="color: #0000ff;">out</span>[maxn];<br /><span style="color: #0000ff;">int</span> head[maxn], ecount;<br /><span style="color: #0000ff;">long</span> <span style="color: #0000ff;">long</span> f[maxn];<br /><span style="color: #0000ff;">bool</span> vis[maxn];<br /><br /><span style="color: #0000ff;">void</span> addedge(<span style="color: #0000ff;">int</span> a, <span style="color: #0000ff;">int</span> b)<br />{<br />    edge[ecount].next = head[a];<br />    edge[ecount].v = b;<br />    head[a] = ecount++;<br />}<br /><br /><span style="color: #0000ff;">void</span> input()<br />{<br />    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; n; i++)<br />        scanf(<span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span>, &amp;value[i]);<br />    memset(<span style="color: #0000ff;">in</span>, <span style="color: #800080;">0</span>, <span style="color: #0000ff;">sizeof</span>(<span style="color: #0000ff;">in</span>));<br />    memset(<span style="color: #0000ff;">out</span>, <span style="color: #800080;">0</span>, <span style="color: #0000ff;">sizeof</span>(<span style="color: #0000ff;">out</span>));<br />    memset(head, -<span style="color: #800080;">1</span>, <span style="color: #0000ff;">sizeof</span>(head));<br />    ecount = <span style="color: #800080;">0</span>;<br />    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; m; i++)<br />    {<br />        <span style="color: #0000ff;">int</span> a, b;<br />        scanf(<span style="color: #800000;">"</span><span style="color: #800000;">%d%d</span><span style="color: #800000;">"</span>, &amp;a, &amp;b);<br />        a--;<br />        b--;<br />        <span style="color: #0000ff;">in</span>[b]++;<br />        <span style="color: #0000ff;">out</span>[a]++;<br />        addedge(a, b);<br />    }<br />}<br /><br /><span style="color: #0000ff;">long</span> <span style="color: #0000ff;">long</span> cal(<span style="color: #0000ff;">int</span> a)<br />{<br />    <span style="color: #0000ff;">if</span> (vis[a])<br />        <span style="color: #0000ff;">return</span> f[a];<br />    f[a] = -<span style="color: #800080;">20000</span>;<br />    f[a] *= maxn;<br />    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = head[a]; i != -<span style="color: #800080;">1</span>; i = edge[i].next)<br />        f[a] = max(f[a], cal(edge[i].v));<br />    f[a] += value[a];<br />    vis[a] = <span style="color: #0000ff;">true</span>;<br />    <span style="color: #0000ff;">return</span> f[a];<br />}<br /><br /><span style="color: #0000ff;">void</span> work()<br />{<br />    memset(vis, <span style="color: #800080;">0</span>, <span style="color: #0000ff;">sizeof</span>(vis));<br />    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; n; i++)<br />        <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">out</span>[i] == <span style="color: #800080;">0</span>)<br />        {<br />            f[i] = value[i];<br />            vis[i] = <span style="color: #0000ff;">true</span>;<br />        }<br />    <span style="color: #0000ff;">long</span> <span style="color: #0000ff;">long</span> ans = -<span style="color: #800080;">20000</span>;<br />    ans *= maxn;<br />    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; n; i++)<br />        <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">in</span>[i] == <span style="color: #800080;">0</span>)<br />        {<br />            ans = max(ans, cal(i));<br />        }<br />    printf(<span style="color: #800000;">"</span><span style="color: #800000;">%lld\n</span><span style="color: #800000;">"</span>, ans);<br />}<br /><br /><span style="color: #0000ff;">int</span> main()<br />{<br />    <span style="color: #008000;">//</span><span style="color: #008000;">freopen("t.txt", "r", stdin);</span><span style="color: #008000;"><br /></span>    <span style="color: #0000ff;">while</span> (~scanf(<span style="color: #800000;">"</span><span style="color: #800000;">%d%d</span><span style="color: #800000;">"</span>, &amp;n, &amp;m))<br />    {<br />        input();<br />        work();<br />    }<br />    <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span>;<br />}</pre>
</div>
</div>
<p></p>
