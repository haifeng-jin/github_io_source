---
layout: post
title: poj1692
category: chinese
---
<p>题意：两个数列，第一行的数字可以和第二行的数字连线。连线有如下条件，被连上的两数字必须相等，且每个数字只能连一条线，每条连线必须与且仅与另一条连线相交，相交两连线上的数字不能相等。问最多能连多少条线。</p>
<p>分析：dp。f[i][j]表示第一行的前i个数字和第二行的前j个数字最多能连几条线，则f[i][j]=max(f[i-1][j],f[i][j-1],f[k-1][l-1]+2)。k是第一行前i-1个数字中最右一个能与第二行j位置连线的数的位置。l同理。这样状态转移为n，状态为n^2，总的时间复杂度为n^3。但是我们可以不用每次顺序查找k,l的值，我们进行预处理。数组last_equal1[i][x]表示第一行前i个数字中最右一个等于x的数字的位置。题中说x的取值范围在100以内，所以空间上是可行的。若第一行第i个数恰好是x那么last_equal1[i][x]=i，否则last_equal1[i][x]=last_equal1[i-1][x]。last_equal2[j][x]同理。这样总复杂度降为n^2。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('4f5f39e7-8625-4937-9112-307ac4fd11b9')"><img id="code_img_closed_4f5f39e7-8625-4937-9112-307ac4fd11b9" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_4f5f39e7-8625-4937-9112-307ac4fd11b9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4f5f39e7-8625-4937-9112-307ac4fd11b9',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" /><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_4f5f39e7-8625-4937-9112-307ac4fd11b9" class="cnblogs_code_hide">
<pre>#include &lt;iostream&gt;<span style="color: #000000;">
#include </span>&lt;cstdio&gt;<span style="color: #000000;">
#include </span>&lt;cstdlib&gt;<span style="color: #000000;">
#include </span>&lt;cstring&gt;
<span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;

</span><span style="color: #0000ff;">#define</span> maxn 105

<span style="color: #0000ff;">int</span><span style="color: #000000;"> n, m;
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> f[maxn][maxn];
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> last_equal1[maxn][maxn], last_equal2[maxn][maxn];
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> chain1[maxn], chain2[maxn];

</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> input()
{
    scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d%d</span><span style="color: #800000;">"</span>, &amp;n, &amp;<span style="color: #000000;">m);
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">1</span>; i &lt;= n; i++<span style="color: #000000;">)
        scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span>, &amp;<span style="color: #000000;">chain1[i]);
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">1</span>; i &lt;= m; i++<span style="color: #000000;">)
        scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span>, &amp;<span style="color: #000000;">chain2[i]);
}

</span><span style="color: #0000ff;">void</span> make(<span style="color: #0000ff;">int</span> n, <span style="color: #0000ff;">int</span> chain[], <span style="color: #0000ff;">int</span><span style="color: #000000;"> last_equal[][maxn])
{
    memset(last_equal, </span><span style="color: #800080;">0</span>, <span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(last_equal));
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">1</span>; i &lt;= n; i++<span style="color: #000000;">)
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = <span style="color: #800080;">1</span>; j &lt;= <span style="color: #800080;">100</span>; j++<span style="color: #000000;">)
            </span><span style="color: #0000ff;">if</span> (chain[i] ==<span style="color: #000000;"> j)
                last_equal[i][j] </span>=<span style="color: #000000;"> i;
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
                last_equal[i][j] </span>= last_equal[i - <span style="color: #800080;">1</span><span style="color: #000000;">][j];
}

</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> work()
{
    make(n, chain1, last_equal1);
    make(m, chain2, last_equal2);
    memset(f, </span><span style="color: #800080;">0</span>, <span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(f));
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">1</span>; i &lt;= n; i++<span style="color: #000000;">)
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = <span style="color: #800080;">1</span>; j &lt;= m; j++<span style="color: #000000;">)
        {
            f[i][j] </span>= max(f[i - <span style="color: #800080;">1</span>][j], f[i][j - <span style="color: #800080;">1</span><span style="color: #000000;">]);
            </span><span style="color: #0000ff;">int</span> a =<span style="color: #000000;"> chain1[i];
            </span><span style="color: #0000ff;">int</span> b =<span style="color: #000000;"> chain2[j];
            </span><span style="color: #0000ff;">int</span> pos1 =<span style="color: #000000;"> last_equal1[i][b];
            </span><span style="color: #0000ff;">int</span> pos2 =<span style="color: #000000;"> last_equal2[j][a];
            </span><span style="color: #0000ff;">if</span> (a != b &amp;&amp; pos1 != <span style="color: #800080;">0</span> &amp;&amp; pos2 != <span style="color: #800080;">0</span><span style="color: #000000;">)
                f[i][j] </span>= max(f[i][j], f[pos1 - <span style="color: #800080;">1</span>][pos2 - <span style="color: #800080;">1</span>] + <span style="color: #800080;">1</span><span style="color: #000000;">);
        }
    </span><span style="color: #0000ff;">return</span> f[n][m] * <span style="color: #800080;">2</span><span style="color: #000000;">;
}

</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
{
    </span><span style="color: #008000;">//</span><span style="color: #008000;">freopen("t.txt", "r", stdin);</span>
    <span style="color: #0000ff;">int</span><span style="color: #000000;"> t;
    scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span>, &amp;<span style="color: #000000;">t);
    </span><span style="color: #0000ff;">while</span> (t--<span style="color: #000000;">)
    {
        input();
        printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span><span style="color: #000000;">, work());
    }
    </span><span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
}</span></pre>
</div>
</div>
<p>&nbsp;</p>
