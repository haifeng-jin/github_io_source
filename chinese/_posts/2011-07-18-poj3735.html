---
layout: post
title: poj3735
category: chinese
---
<p>矩阵乘法</p>
<p>题意：一个一维数组，全为0，对它进行一系列操作，包括某位＋1，某位清零，交换某两位。将这一系列操作进行m次。问数组的最终情况。</p>
<p>分析：数组的元素从第一位开始，把第0位附为1，我们构造一个n*n矩阵使得原1＊n矩阵每乘以一次这个矩阵,得到的结果就相当于进行了一次一系列操作。然后用矩阵快速幂即可。构造矩阵的方法是：操作一，0行某列位置元素++；操作二，某列清零；操作三，交换两列。</p>
<p>矩阵乘法需要优化：</p>
<p>&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; a.x; i++)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; for (int k = 0; k &lt; a.y; k++)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span style="color: #ff0000;"> if (a.a[i][k])</span><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; for (int j = 0; j &lt; b.y; j++)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ret.a[i][j] += a.a[i][k] * b.a[k][j];</p>
<p>否则超时。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('fe57a464-97cd-4735-bd0f-6c36c7302fd0')"><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" class="code_img_closed" id="code_img_closed_fe57a464-97cd-4735-bd0f-6c36c7302fd0" /><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" class="code_img_opened" id="code_img_opened_fe57a464-97cd-4735-bd0f-6c36c7302fd0" onclick="cnblogs_code_hide('fe57a464-97cd-4735-bd0f-6c36c7302fd0',event)" style="display: none;" /><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_fe57a464-97cd-4735-bd0f-6c36c7302fd0" class="cnblogs_code_hide">
<pre><span style="color: #000000;">#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">iostream</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstdio</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstdlib</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br />#include </span><span style="color: #000000;">&lt;</span><span style="color: #000000;">cstring</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> </span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;<br /><br /></span><span style="color: #0000ff;">#define</span><span style="color: #000000;"> maxn 110</span><span style="color: #000000;"><br /><br /></span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Matrix<br />{<br />    </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> x, y;<br />    </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> a[maxn][maxn];<br />} f, temp;<br /><br /></span><span style="color: #0000ff;">long</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> n, m, r;<br /><br />Matrix mul(Matrix </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">a, Matrix </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">b)<br />{<br />    Matrix ret;<br />    memset(ret.a, </span><span style="color: #800080;">0</span><span style="color: #000000;">, </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(ret.a));<br />    ret.x </span><span style="color: #000000;">=</span><span style="color: #000000;"> a.x;<br />    ret.y </span><span style="color: #000000;">=</span><span style="color: #000000;"> b.y;<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> a.x; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> k </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; k </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> a.y; k</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (a.a[i][k])<br />                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> j </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; j </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> b.y; j</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />                    ret.a[i][j] </span><span style="color: #000000;">+=</span><span style="color: #000000;"> a.a[i][k] </span><span style="color: #000000;">*</span><span style="color: #000000;"> b.a[k][j];<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ret;<br />}<br /><br />Matrix power(Matrix </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">a, </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> </span><span style="color: #0000ff;">long</span><span style="color: #000000;"> n)<br />{<br />    Matrix m </span><span style="color: #000000;">=</span><span style="color: #000000;"> a;<br />    Matrix ret;<br />    memset(ret.a, </span><span style="color: #800080;">0</span><span style="color: #000000;">, </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(ret.a));<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> a.x; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />        ret.a[i][i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />    ret.x </span><span style="color: #000000;">=</span><span style="color: #000000;"> ret.y </span><span style="color: #000000;">=</span><span style="color: #000000;"> a.x;<br />    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (n </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br />    {<br />        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (</span><span style="color: #800080;">1</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;</span><span style="color: #000000;"> n)<br />            ret </span><span style="color: #000000;">=</span><span style="color: #000000;"> mul(ret, m);<br />        m </span><span style="color: #000000;">=</span><span style="color: #000000;"> mul(m, m);<br />        n </span><span style="color: #000000;">&gt;&gt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />    }<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ret;<br />}<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> input()<br />{<br />    memset(f.a, </span><span style="color: #800080;">0</span><span style="color: #000000;">, </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(f.a));<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> n; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />        f.a[i][i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />    f.x </span><span style="color: #000000;">=</span><span style="color: #000000;"> f.y </span><span style="color: #000000;">=</span><span style="color: #000000;"> n </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> m; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />    {<br />        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> a, b;<br />        </span><span style="color: #0000ff;">char</span><span style="color: #000000;"> ch[</span><span style="color: #800080;">2</span><span style="color: #000000;">];<br />        scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%s</span><span style="color: #800000;">"</span><span style="color: #000000;">, ch);<br />        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ch[</span><span style="color: #800080;">0</span><span style="color: #000000;">] </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800000;">'</span><span style="color: #800000;">g</span><span style="color: #800000;">'</span><span style="color: #000000;">)<br />        {<br />            scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">a);<br />            f.a[</span><span style="color: #800080;">0</span><span style="color: #000000;">][a]</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br />        }<br />        </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ch[</span><span style="color: #800080;">0</span><span style="color: #000000;">] </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800000;">'</span><span style="color: #800000;">e</span><span style="color: #800000;">'</span><span style="color: #000000;">)<br />        {<br />            scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">a);<br />            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> j </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; j </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> n; j</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />                f.a[j][a] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />        }<br />        </span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br />        {<br />            scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d%d</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">a, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">b);<br />            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> j </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; j </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> n; j</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />                swap(f.a[j][a], f.a[j][b]);<br />        }<br />    }<br />}<br /><br /></span><span style="color: #0000ff;">void</span><span style="color: #000000;"> work()<br />{<br />    Matrix ans;<br />    memset(ans.a, </span><span style="color: #800080;">0</span><span style="color: #000000;">, </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(ans.a));<br />    ans.x </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />    ans.y </span><span style="color: #000000;">=</span><span style="color: #000000;"> n </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />    ans.a[</span><span style="color: #800080;">0</span><span style="color: #000000;">][</span><span style="color: #800080;">0</span><span style="color: #000000;">] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />    ans </span><span style="color: #000000;">=</span><span style="color: #000000;"> mul(ans, f);<br />    printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%lld</span><span style="color: #800000;">"</span><span style="color: #000000;">, ans.a[</span><span style="color: #800080;">0</span><span style="color: #000000;">][</span><span style="color: #800080;">1</span><span style="color: #000000;">]);<br />    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> n; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />        printf(</span><span style="color: #800000;">"</span><span style="color: #800000;"> %lld</span><span style="color: #800000;">"</span><span style="color: #000000;">, ans.a[</span><span style="color: #800080;">0</span><span style="color: #000000;">][i]);<br />    putchar(</span><span style="color: #800000;">'</span><span style="color: #800000;">\n</span><span style="color: #800000;">'</span><span style="color: #000000;">);<br />}<br /><br /></span><span style="color: #0000ff;">int</span><span style="color: #000000;"> main()<br />{<br />    </span><span style="color: #008000;">//</span><span style="color: #008000;">freopen("t.txt", "r", stdin);</span><span style="color: #008000;"><br /></span><span style="color: #000000;">    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%lld%lld%lld</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">n, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">r, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">m), n </span><span style="color: #000000;">|</span><span style="color: #000000;"> r </span><span style="color: #000000;">|</span><span style="color: #000000;"> m)<br />    {<br />        input();<br />        f </span><span style="color: #000000;">=</span><span style="color: #000000;"> power(f, r);<br />        work();<br />    }<br />    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />}</span></pre>
</div>
</div>
