---
layout: post
title: poj1204
category: chinese
---
<p>dfa，ac自动机。</p>
<p>题意：给定一些单词，给定一个矩阵，在矩阵内8方向找每个单词是否出现过。输出每个单词的出现位置和方向。</p>
<p>分析：分别以位于矩阵四周的点作为起点，每个起点找向8个方向最长的字符串，分别加入自动机。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('95caa394-ca74-47af-9c1b-34a3e171b323')"><img id="code_img_closed_95caa394-ca74-47af-9c1b-34a3e171b323" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" /><img id="code_img_opened_95caa394-ca74-47af-9c1b-34a3e171b323" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('95caa394-ca74-47af-9c1b-34a3e171b323',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt="" /><span class="cnblogs_code_collapse">View Code </span>
<div id="cnblogs_code_open_95caa394-ca74-47af-9c1b-34a3e171b323" class="cnblogs_code_hide">
<pre>#include &lt;iostream&gt;<span style="color: #000000;">
#include </span>&lt;cstdio&gt;<span style="color: #000000;">
#include </span>&lt;cstdlib&gt;<span style="color: #000000;">
#include </span>&lt;cstring&gt;
<span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;

</span><span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> kind = <span style="color: #800080;">26</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> node
{
    node </span>*fail; <span style="color: #008000;">//</span><span style="color: #008000;">失败指针</span>
    node *next[kind]; <span style="color: #008000;">//</span><span style="color: #008000;">Tire每个节点的26个子节点（最多26个字母）</span>
    <span style="color: #0000ff;">int</span> id; <span style="color: #008000;">//</span><span style="color: #008000;">是否为该单词的最后一个节点</span>
<span style="color: #000000;">    node()
    { </span><span style="color: #008000;">//</span><span style="color: #008000;">构造函数初始化</span>
        fail =<span style="color: #000000;"> NULL;
        id </span>= -<span style="color: #800080;">1</span><span style="color: #000000;">;
        memset(next, (</span><span style="color: #0000ff;">int</span>) NULL, <span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(next));
    }
}</span>*q[<span style="color: #800080;">500001</span>], *root; <span style="color: #008000;">//</span><span style="color: #008000;">队列，方便用于bfs构造失败指针</span>
<span style="color: #0000ff;">char</span> str[<span style="color: #800080;">1005</span>]; <span style="color: #008000;">//</span><span style="color: #008000;">模式串</span>

<span style="color: #0000ff;">#define</span> maxn 1005
<span style="color: #0000ff;">#define</span> maxl 305

<span style="color: #0000ff;">int</span><span style="color: #000000;"> l, c, w;
</span><span style="color: #0000ff;">char</span><span style="color: #000000;"> map[maxn][maxn];
</span><span style="color: #0000ff;">char</span><span style="color: #000000;"> word[maxn][maxl];
</span><span style="color: #0000ff;">int</span> dir[<span style="color: #800080;">8</span>][<span style="color: #800080;">2</span>] =<span style="color: #000000;">
{
{ </span>-<span style="color: #800080;">1</span>, <span style="color: #800080;">0</span><span style="color: #000000;"> },
{ </span>-<span style="color: #800080;">1</span>, <span style="color: #800080;">1</span><span style="color: #000000;"> },
{ </span><span style="color: #800080;">0</span>, <span style="color: #800080;">1</span><span style="color: #000000;"> },
{ </span><span style="color: #800080;">1</span>, <span style="color: #800080;">1</span><span style="color: #000000;"> },
{ </span><span style="color: #800080;">1</span>, <span style="color: #800080;">0</span><span style="color: #000000;"> },
{ </span><span style="color: #800080;">1</span>, -<span style="color: #800080;">1</span><span style="color: #000000;"> },
{ </span><span style="color: #800080;">0</span>, -<span style="color: #800080;">1</span><span style="color: #000000;"> },
{ </span>-<span style="color: #800080;">1</span>, -<span style="color: #800080;">1</span><span style="color: #000000;"> } };
</span><span style="color: #0000ff;">int</span> ans[maxn][<span style="color: #800080;">3</span><span style="color: #000000;">];
</span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> vis[maxn];
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> nowx, nowy, nowd;
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> len[maxn];

</span><span style="color: #0000ff;">void</span> insert(<span style="color: #0000ff;">char</span> *str, node *root, <span style="color: #0000ff;">int</span><span style="color: #000000;"> id)
{
    node </span>*p =<span style="color: #000000;"> root;
    </span><span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span><span style="color: #000000;">, index;
    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (str[i])
    {
        index </span>= str[i] - <span style="color: #800000;">'</span><span style="color: #800000;">A</span><span style="color: #800000;">'</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">if</span> (p-&gt;next[index] ==<span style="color: #000000;"> NULL)
            p</span>-&gt;next[index] = <span style="color: #0000ff;">new</span><span style="color: #000000;"> node();
        p </span>= p-&gt;<span style="color: #000000;">next[index];
        i</span>++<span style="color: #000000;">;
    }
    p</span>-&gt;id =<span style="color: #000000;"> id;
}
</span><span style="color: #0000ff;">void</span> build_ac_automation(node *<span style="color: #000000;">root)
{
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i;
    </span><span style="color: #0000ff;">int</span> head, tail; <span style="color: #008000;">//</span><span style="color: #008000;">队列的头尾指针</span>
    head = tail = <span style="color: #800080;">0</span><span style="color: #000000;">;
    root</span>-&gt;fail =<span style="color: #000000;"> NULL;
    q[head</span>++] =<span style="color: #000000;"> root;
    </span><span style="color: #0000ff;">while</span> (head !=<span style="color: #000000;"> tail)
    {
        node </span>*temp = q[tail++<span style="color: #000000;">];
        node </span>*p =<span style="color: #000000;"> NULL;
        </span><span style="color: #0000ff;">for</span> (i = <span style="color: #800080;">0</span>; i &lt; <span style="color: #800080;">26</span>; i++<span style="color: #000000;">)
        {
            </span><span style="color: #0000ff;">if</span> (temp-&gt;next[i] !=<span style="color: #000000;"> NULL)
            {
                p </span>= temp-&gt;<span style="color: #000000;">fail;
                </span><span style="color: #0000ff;">while</span> (p != NULL &amp;&amp; p-&gt;next[i] ==<span style="color: #000000;"> NULL)
                    p </span>= p-&gt;<span style="color: #000000;">fail;
                </span><span style="color: #0000ff;">if</span> (p ==<span style="color: #000000;"> NULL)
                    temp</span>-&gt;next[i]-&gt;fail =<span style="color: #000000;"> root;
                </span><span style="color: #0000ff;">else</span><span style="color: #000000;">
                    temp</span>-&gt;next[i]-&gt;fail = p-&gt;<span style="color: #000000;">next[i];
                q[head</span>++] = temp-&gt;<span style="color: #000000;">next[i];
            }
        }
    }
}

</span><span style="color: #0000ff;">void</span> makeans(<span style="color: #0000ff;">int</span> id, <span style="color: #0000ff;">int</span><span style="color: #000000;"> pos)
{
    vis[id] </span>= <span style="color: #0000ff;">true</span><span style="color: #000000;">;
    ans[id][</span><span style="color: #800080;">0</span>] = nowx + dir[nowd][<span style="color: #800080;">0</span>] * (pos - len[id] + <span style="color: #800080;">1</span><span style="color: #000000;">);
    ans[id][</span><span style="color: #800080;">1</span>] = nowy + dir[nowd][<span style="color: #800080;">1</span>] * (pos - len[id] + <span style="color: #800080;">1</span><span style="color: #000000;">);
    ans[id][</span><span style="color: #800080;">2</span>] =<span style="color: #000000;"> nowd;
}

</span><span style="color: #0000ff;">int</span> query(node *root, <span style="color: #0000ff;">char</span>*<span style="color: #000000;"> str)
{
    </span><span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>, cnt = <span style="color: #800080;">0</span><span style="color: #000000;">, index;
    node </span>*p =<span style="color: #000000;"> root;
    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (str[i])
    {
        index </span>= str[i] - <span style="color: #800000;">'</span><span style="color: #800000;">A</span><span style="color: #800000;">'</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">while</span> (p-&gt;next[index] == NULL &amp;&amp; p !=<span style="color: #000000;"> root)
            p </span>= p-&gt;<span style="color: #000000;">fail;
        p </span>= p-&gt;<span style="color: #000000;">next[index];
        p </span>= (p == NULL) ?<span style="color: #000000;"> root : p;
        node </span>*temp =<span style="color: #000000;"> p;
        </span><span style="color: #0000ff;">while</span> (temp !=<span style="color: #000000;"> root)
        {
            </span><span style="color: #0000ff;">if</span> (temp-&gt;id != -<span style="color: #800080;">1</span> &amp;&amp; !vis[temp-&gt;<span style="color: #000000;">id])
                makeans(temp</span>-&gt;<span style="color: #000000;">id, i);
            temp </span>= temp-&gt;<span style="color: #000000;">fail;
        }
        i</span>++<span style="color: #000000;">;
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> cnt;
}

</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> input()
{
    scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d%d%d</span><span style="color: #800000;">"</span>, &amp;l, &amp;c, &amp;<span style="color: #000000;">w);
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; l; i++<span style="color: #000000;">)
        scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%s</span><span style="color: #800000;">"</span><span style="color: #000000;">, map[i]);
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; w; i++<span style="color: #000000;">)
    {
        scanf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%s</span><span style="color: #800000;">"</span><span style="color: #000000;">, word[i]);
        insert(word[i], root, i);
        len[i] </span>=<span style="color: #000000;"> strlen(word[i]);
    }
}

</span><span style="color: #0000ff;">bool</span> ok(<span style="color: #0000ff;">int</span> x, <span style="color: #0000ff;">int</span><span style="color: #000000;"> y)
{
    </span><span style="color: #0000ff;">return</span> x &gt;= <span style="color: #800080;">0</span> &amp;&amp; y &gt;= <span style="color: #800080;">0</span> &amp;&amp; x &lt; l &amp;&amp; y &lt;<span style="color: #000000;"> c;
}

</span><span style="color: #0000ff;">void</span> make(<span style="color: #0000ff;">int</span> x, <span style="color: #0000ff;">int</span> y, <span style="color: #0000ff;">int</span><span style="color: #000000;"> d)
{
    </span><span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span><span style="color: #000000;">;
    nowx </span>=<span style="color: #000000;"> x;
    nowy </span>=<span style="color: #000000;"> y;
    nowd </span>=<span style="color: #000000;"> d;
    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (ok(x, y))
    {
        str[i</span>++] =<span style="color: #000000;"> map[x][y];
        x </span>+= dir[d][<span style="color: #800080;">0</span><span style="color: #000000;">];
        y </span>+= dir[d][<span style="color: #800080;">1</span><span style="color: #000000;">];
    }
    str[i] </span>= <span style="color: #800080;">0</span><span style="color: #000000;">;
    query(root, str);
}

</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> work()
{
    build_ac_automation(root);
    memset(vis, </span><span style="color: #800080;">0</span>, <span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(vis));
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; l; i++<span style="color: #000000;">)
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = <span style="color: #800080;">0</span>; j &lt; <span style="color: #800080;">8</span>; j++<span style="color: #000000;">)
        {
            make(i, </span><span style="color: #800080;">0</span><span style="color: #000000;">, j);
            make(i, c </span>- <span style="color: #800080;">1</span><span style="color: #000000;">, j);
        }
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; c; i++<span style="color: #000000;">)
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = <span style="color: #800080;">0</span>; j &lt; <span style="color: #800080;">8</span>; j++<span style="color: #000000;">)
        {
            make(</span><span style="color: #800080;">0</span><span style="color: #000000;">, i, j);
            make(l </span>- <span style="color: #800080;">1</span><span style="color: #000000;">, i, j);
        }
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; w; i++<span style="color: #000000;">)
        printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">%d %d %c\n</span><span style="color: #800000;">"</span>, ans[i][<span style="color: #800080;">0</span>], ans[i][<span style="color: #800080;">1</span>], (<span style="color: #0000ff;">char</span>) (ans[i][<span style="color: #800080;">2</span>] + <span style="color: #800000;">'</span><span style="color: #800000;">A</span><span style="color: #800000;">'</span><span style="color: #000000;">));
}

</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
{
    </span><span style="color: #008000;">//</span><span style="color: #008000;">freopen("t.txt", "r", stdin);</span>
    root = <span style="color: #0000ff;">new</span><span style="color: #000000;"> node();
    input();
    work();
    </span><span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
}</span></pre>
</div>
</div>
